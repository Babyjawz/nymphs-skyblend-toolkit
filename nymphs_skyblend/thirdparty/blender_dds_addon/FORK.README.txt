# Blender DDS Addon – Script-Safe Fork
This is a fork of [matyalatte/Blender-DDS-Addon](https://github.com/matyalatte/Blender-DDS-Addon), updated for compatibility with Blender 4.5 and extended to support scripted DDS exports (for example, from automated pipelines like pbrgen.py).

## What This Addon Does
The Blender DDS Addon enables importing and exporting of .DDS (DirectDraw Surface) texture files, supporting DirectX DXGI texture compression formats such as BC1–BC7, ASTC, and others. It uses external tools like texconv and astcenc for conversion and allows you to choose DXGI formats directly in Blender’s UI.

## Why This Fork Exists
The original addon assumes users will export DDS files through Blender’s UI panel, where a DXGI format can be selected manually. However, when the exporter is called from a Python script (for example, a batch exporter or render automation script), it fails with:

RuntimeError: Select DXGI format.

This occurs because the exporter checks only the image-level DXGI property (tex.dds_props.dxgi_format), which defaults to "NONE", and does not look at the global scene settings.

## Fix Included in This Fork
This fork modifies one file: blender_dds_addon/ui/export_dds.py

Original code:
if dxgi == "NONE":
    raise RuntimeError("Select DXGI format.")

Patched version:
# --- patched for Blender 4.5 scripted export ---
if dxgi in (None, "NONE", "None", ""):
    # Try to fall back to the scene's DDS options
    scene_opts = bpy.context.scene.dds_options
    dxgi = getattr(scene_opts, "dxgi_format", dxgi)

    # If still empty, check image DDS props directly
    if dxgi in (None, "NONE", "None", "") and hasattr(tex, "dds_props"):
        prop_fmt = getattr(tex.dds_props, "dxgi_format", "NONE")
        if prop_fmt not in (None, "NONE", "None", ""):
            dxgi = prop_fmt

    # If still unset, throw the error
    if dxgi in (None, "NONE", "None", ""):
        raise RuntimeError("Select DXGI format (no valid DXGI format found).")

This patch ensures:
- Scripted exports now succeed without manual UI interaction.
- The exporter automatically pulls the DXGI format from the scene-level DDS options if the image-level one is missing.
- Full backward compatibility with UI-driven exports remains intact.

## Usage
Example scripted export:
import bpy
from blender_dds_addon.ui import export_dds as edds

scene = bpy.context.scene
scene.dds_options.dxgi_format = "BC7_UNORM"  # choose your DXGI format

# Make sure to render or use an existing image
bpy.ops.render.render(write_still=False)
bpy.data.images['Render Result'].save_render("C:/Temp/temp.png")
img = bpy.data.images.load("C:/Temp/temp.png")

edds.export_as_dds(bpy.context, img, "C:/Temp/test.dds")
print("DDS export complete.")

## Summary
- Fixed the RuntimeError: Select DXGI format. issue during script-driven exports.
- Fully compatible with Blender 4.5.
- No UI dependency — works in headless/batch render pipelines.
- Safe fallback logic (Scene → Image) for DXGI selection.

## Credits
Original author: matyalatte (https://github.com/matyalatte)
Script-safe patch and Blender 4.5 compatibility: your name here


______________________________________________________________________________________________


### Blender 4.5 Compatibility Patch Summary (for Blender-DDS-Addon)

Affected files:
- blender_dds_addon/ui/export_dds.py
- blender_dds_addon/ui/import_dds.py
- blender_dds_addon/ui/custom_properties.py

Reason:
Blender 4.4+ hides Image Editor N-panel tabs unless panels define a context. The DDS add-on’s panels were missing this, causing the “DDS” tab to disappear in Blender 4.5.

Change:
Add the following line inside each bpy.types.Panel subclass that uses
    bl_space_type = "IMAGE_EDITOR"
    bl_region_type = "UI"

    bl_context = "image"   # Required for Blender 4.4+

Patched classes:
- DDS_PT_export_panel  (in ui/export_dds.py)
- DDS_PT_import_panel  (in ui/import_dds.py)
- DDS_PT_property_panel (in ui/custom_properties.py)

Result:
✅ “DDS” sidebar tab now visible again in the Image Editor (N-panel)
✅ Import / Export / Custom Properties panels all display correctly
✅ No further code or API changes required — add-on is fully functional in Blender 4.5

